apply plugin: 'konan'

konanArtifacts {
    library(project.name, targets: ["ios_arm64", "ios_x64", "macos_x64"]) {
        enableMultiplatform true
        artifactName project.name.replace('-', '_')
    }
    program("${project.name}-test", targets: ["macos_x64"]) {
        srcDir 'src/test/kotlin'
        commonSourceSet 'test'
        libraries {
            artifact project.name
        }
        extraOpts '-tr'
    }
}

dependencies {
    expectedBy project(':atomicfu-common')
}

task test(dependsOn: run)

// todo: figure out how to avoid uploading of test artifacts

publishToMavenLocal.dependsOn(build)

